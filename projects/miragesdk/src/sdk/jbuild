(jbuild_version 1)

(library
 ((name sdk)
  (libraries (threads cstruct.lwt cmdliner fmt.cli logs.fmt logs.cli fmt.tty
              decompress irmin irmin-git lwt.unix rawlink tuntap dispatch
              irmin-watcher inotify astring rresult mirage-flow-lwt
              mirage-channel-lwt io-page.unix ipaddr capnp))
 ))

(rule
  ((targets (proto.ml proto.mli))
   (deps (proto.capnp))
   (action (progn
     (run capnp compile -o ocaml ${<})
     (system "mv proto.ml proto.ml.in")
     (system "echo '[@@@ocaml.warning \"-A\"]\n' > proto.ml")
     (system "cat proto.ml.in >> proto.ml")))))
