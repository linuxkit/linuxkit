#!/sbin/openrc-run

description="Configuring settings from database."

depend() {
	# AWS gets settings via network
	need net
	before docker
}

start() {
	ebegin "Configuring host settings from database"

	# only first part should be in /etc/hostname
	mobyconfig exists etc/hostname && \
	( HOSTNAME="$(mobyconfig get etc/hostname)" && \
	  echo $HOSTNAME | sed 's/\..*//' >> /etc/hostname && \
	  hostname $HOSTNAME )

	mobyconfig exists etc/sysctl.conf && mobyconfig get etc/sysctl.conf > /etc/sysctl.conf
	mobyconfig exists etc/sysfs.conf && mobyconfig get etc/sysfs.conf > /etc/sysfs.conf

	mobyconfig exists random-seed && mobyconfig get random-seed > /dev/urandom

	mobyconfig exists etc/resolv.conf && mobyconfig get etc/resolv.conf > /etc/resolv.conf
	mobyconfig exists etc/hosts && mobyconfig get etc/hosts >> /etc/hosts

	mobyconfig exists etc/ssl/certs/ca-certificates.crt && mobyconfig get etc/ssl/certs/ca-certificates.crt >> /etc/ssl/certs/ca-certificates.crt 

	eend 0
}
