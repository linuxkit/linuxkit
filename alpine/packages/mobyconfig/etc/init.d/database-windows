#!/sbin/openrc-run

description="Set up database (Windows)."

depend() {
	before docker hostsettings windowsnet
}

start() {
	[ "$(mobyplatform)" = "windows" ] || exit 0

	ebegin "Setting up database (Windows)"

	mkdir -p /Database
	mount -t tmpfs tmpfs /Database
	mkdir -p /tmp/db
	/sbin/9pmount-vsock listen db /tmp/db
	[ $? -ne 0 ] && rm -rf /Database && printf "Could not mount configuration database\n" 1>&2 && eend 1
	cp -a /tmp/db/branch/master/ro/com.docker.driver.amd64-linux/* /Database
	umount /tmp/db

	eend 0
}
