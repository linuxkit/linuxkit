#!/sbin/openrc-run

description="Sets the hostname of the machine."

depend() {
	need 9pinit
}

start() {
	opts="docker"
	if cat /proc/cmdline | grep -q 'com.docker.database'
	then
		DATABASE="$(cat /proc/cmdline | sed -e 's/.*com.docker.database="//' -e 's/".*//')"
		HOSTFILE="/Database/branch/master/ro/${DATABASE}/etc/hostname"
		[ -s ${HOSTFILE} ] && opts="-F ${HOSTFILE}"
	else
		[ -s /etc/hostname ] && opts="-F /etc/hostname"
	fi
	ebegin "Setting hostname"
	hostname $opts
	eend $?
}
